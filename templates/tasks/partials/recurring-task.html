<div class="flex mt-1"
     x-data="{ loading: false, deleted: false}"
     hx-target="this"

>
    <div class="d-flex d-md-column">
        <div class="col-md-5 col-12 pr-1">
            <label for="{{ recurring_task.pk }}-start-date" class="form-label">Start Date</label>
            <input name="start-date"
                   type="date"
                   id="{{ recurring_task.pk }}-start-date"
                   class="form-control"
                   hx-post="{% url 'update-recurring-task' recurring_task.pk %}"
                   hx-trigger="change"
                   @change="() => {
                    // short interval to let htmx send out the post request before disabling the input form
                    // otherwise, the input form will not have the correct value
                    await new Promise(resolve => setTimeout(resolve, 200));
                    loading = true";
                   }
                   x-bind:disabled="loading"
                   value="{{ recurring_task.start_date|date:'Y-m-d' }}"/>
        </div>
        <div class="col-md-5 col-12 pr-1">
            <label for="{{ recurring_task.pk }}-interval" class="form-label">Interval</label>
            <select class="form-select"
                    name="interval"
                    @change="loading = true"
                    hx-post="{% url 'update-recurring-task' recurring_task.pk %}"
                    hx-trigger="change"
                    x-bind:disabled="loading"
                    id="{{ recurring_task.pk }}-interval">
                {% for choice in interval_choices %}
                <option value="{{ choice.0 }}"
                        {% if recurring_task.interval in choice.0 %} selected="selected" {% endif %}
                >
                    {{ choice.1 }}
                </option>
                {% endfor %}
            </select>
        </div>
        <div class="d-flex flex-column justify-content-end ml-1 col-md-1 col-12">
            <div class="d-inline-block align-self-end">
                <input type="hidden" value="{{recurring_task.pk}}" name="task-id"/>
                <button type="submit"
                        class="btn btn-danger"
                        @click="() => {
                            loading = true;
                            deleted = true;
                        }"
                        x-bind:disabled="loading"
                        hx-delete="{% url 'delete-recurring-task' recurring_task.pk %}"
                        hx-trigger="click"
                >
                    <span x-show="!deleted">X</span>
                    <span x-show="deleted">
                        <span class="spinner-border spinner-border-sm"
                              role="status"
                              aria-hidden="true"></span>
                    </span>
                </button>
            </div>
        </div>
    </div>
    <small x-show="loading == false"
           class="text-muted">This task will be created again in {{ recurring_task.days_till_next_task }}
        days.</small>
    <small x-cloak x-show="loading && !deleted" class="text-muted">
        <span class="spinner-border spinner-border-sm"
              role="status"
              aria-hidden="true"></span>
        Loading...</small>
</div>